# ğŸ¤– DNM æ™ºèƒ½ä½“åŠŸèƒ½æ¶æ„æ–‡æ¡£

> æœ¬æ–‡æ¡£è¯¦ç»†æè¿° DNM æ™ºèƒ½ä½“ç»ˆç«¯æ§åˆ¶å·¥å…·çš„æ‰€æœ‰åŠŸèƒ½æ¨¡å—ã€å®ç°æµç¨‹å’ŒæŠ€æœ¯æ¶æ„ï¼Œä¸ºåç»­å¼€å‘è€…æä¾›å…¨é¢çš„ç†è§£æŒ‡å—ã€‚

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è§ˆ](#é¡¹ç›®æ¦‚è§ˆ)
- [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
- [åŠŸèƒ½æ¨¡å—è¯¦è§£](#åŠŸèƒ½æ¨¡å—è¯¦è§£)
- [å·¥ä½œæµç¨‹](#å·¥ä½œæµç¨‹)
- [æŠ€æœ¯å®ç°](#æŠ€æœ¯å®ç°)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)

---

## ğŸ¯ é¡¹ç›®æ¦‚è§ˆ

### é¡¹ç›®ç®€ä»‹
DNM æ˜¯ä¸€ä¸ªåŸºäº LangGraph å’Œ LangChain çš„æ™ºèƒ½ç»ˆç«¯åŠ©æ‰‹ï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€æ‰§è¡Œå‘½ä»¤ã€æ–‡ä»¶æ“ä½œã€ä»£ç ç”Ÿæˆå’Œæ™ºèƒ½é—®ç­”ã€‚é¡¹ç›®é‡‡ç”¨åŒ LLM æ¶æ„ï¼Œé€šè¿‡ MCP (Model Context Protocol) é›†æˆå®ç°å¼ºå¤§çš„å·¥å…·è°ƒç”¨èƒ½åŠ›ã€‚

### æ ¸å¿ƒç‰¹æ€§
- ğŸ—£ï¸ **è‡ªç„¶è¯­è¨€æ‰§è¡Œå‘½ä»¤** - ç”¨äººè¯è¯´ï¼Œè®© AI æ‰§è¡Œç»ˆç«¯å‘½ä»¤
- ğŸ“ **@ æ™ºèƒ½æ–‡ä»¶å¼•ç”¨** - äº¤äº’å¼æ–‡ä»¶é€‰æ‹©å™¨ï¼ŒIDE é£æ ¼è‡ªåŠ¨è¡¥å…¨
- ğŸ§  **å¯¹è¯è®°å¿†** - è®°ä½ä¸Šä¸‹æ–‡ï¼Œæ”¯æŒè¿ç»­å¯¹è¯
- ğŸ“ **Git æ™ºèƒ½å·¥å…·** - è‡ªåŠ¨ç”Ÿæˆ commit æ¶ˆæ¯ã€å®Œæ•´å·¥ä½œæµ
- ğŸ“Š **æ•°æ®è½¬æ¢å·¥å…·** - JSON/CSV/YAML/XML æ ¼å¼äº’è½¬ã€éªŒè¯
- ğŸ” **ç¯å¢ƒè¯Šæ–­** - è‡ªåŠ¨æ£€æµ‹å¼€å‘ç¯å¢ƒé…ç½®å’Œä¾èµ–é—®é¢˜
- ğŸ“‹ **å¾…åŠäº‹é¡¹ç®¡ç†** - æ™ºèƒ½è¯†åˆ«å¹¶ç®¡ç†æ—¥ç¨‹å®‰æ’å’Œä»»åŠ¡æé†’
- ğŸ”Œ **MCP é›†æˆ** - æ–‡ä»¶ç³»ç»Ÿå’Œæ¡Œé¢æ§åˆ¶åŠŸèƒ½
- ğŸ¯ **åŒ LLM æ¶æ„** - é€šç”¨æ¨¡å‹å¤„ç†å¯¹è¯ï¼Œä»£ç æ¨¡å‹ç”Ÿæˆå‘½ä»¤

### å…¥å£æ–‡ä»¶
ä¸»å…¥å£æ–‡ä»¶æ˜¯ `dnm`ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„ Python è„šæœ¬ï¼Œæä¾› CLI æ¥å£ã€‚

---

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„

### æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLI å…¥å£å±‚                           â”‚
â”‚                      dnm (ä¸»ç¨‹åº)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·ç•Œé¢å±‚                             â”‚
â”‚  â€¢ agent_ui.py - ç”¨æˆ·äº¤äº’å’Œç‰¹æ®Šå‘½ä»¤                        â”‚
â”‚  â€¢ input_handlers.py - æ™ºèƒ½è¾“å…¥å¤„ç†                        â”‚
â”‚  â€¢ smart_file_input.py - IDE é£æ ¼æ–‡ä»¶è¾“å…¥                  â”‚
â”‚  â€¢ interactive_file_selector.py - äº¤äº’å¼æ–‡ä»¶é€‰æ‹©å™¨         â”‚
â”‚  â€¢ file_reference_parser.py - @ æ–‡ä»¶å¼•ç”¨è§£æ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å·¥ä½œæµå±‚                               â”‚
â”‚  â€¢ agent_workflow.py - LangGraph å·¥ä½œæµå®šä¹‰å’Œè·¯ç”±          â”‚
â”‚  â€¢ agent_nodes.py - æ‰€æœ‰å·¥ä½œæµèŠ‚ç‚¹å®ç°                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å·¥å…·å±‚                                 â”‚
â”‚  â€¢ mcp_manager.py - MCP å·¥å…·ç®¡ç†å’Œè°ƒç”¨                     â”‚
â”‚  â€¢ agent_tool_calling.py - æ™ºèƒ½å·¥å…·é€‰æ‹©å’Œè°ƒç”¨              â”‚
â”‚  â€¢ todo_manager.py - å¾…åŠäº‹é¡¹ç®¡ç†                          â”‚
â”‚  â€¢ git_tools.py - Git æ“ä½œå·¥å…·                             â”‚
â”‚  â€¢ data_converter_tools.py - æ•°æ®è½¬æ¢å·¥å…·                  â”‚
â”‚  â€¢ env_diagnostic_tools.py - ç¯å¢ƒè¯Šæ–­å·¥å…·                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ”¯æŒå±‚                                 â”‚
â”‚  â€¢ agent_config.py - åŒ LLM é…ç½®ã€å·¥ä½œç›®å½•ã€å®‰å…¨é…ç½®       â”‚
â”‚  â€¢ agent_memory.py - å¯¹è¯å†å²ç®¡ç†                          â”‚
â”‚  â€¢ agent_llm.py - LLM å®ä¾‹åŒ–å’Œç®¡ç†                         â”‚
â”‚  â€¢ agent_utils.py - å·¥å…·å‡½æ•°                               â”‚
â”‚  â€¢ agent_types.py - ç±»å‹å®šä¹‰å’Œæ•°æ®ç»“æ„                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŒ LLM æ¶æ„

é¡¹ç›®é‡‡ç”¨åŒ LLM æ¶æ„ï¼Œé’ˆå¯¹ä¸åŒä»»åŠ¡ä½¿ç”¨ä¸åŒçš„æ¨¡å‹ï¼š

- **é€šç”¨æ¨¡å‹** (`LLM_CONFIG`): Kimi-K2 - ç”¨äºæ„å›¾åˆ†æã€æ™ºèƒ½é—®ç­”ã€ä¸Šä¸‹æ–‡ç†è§£
- **ä»£ç æ¨¡å‹** (`LLM_CONFIG2`): Claude-3.5-Sonnet - ç”¨äºå‘½ä»¤ç”Ÿæˆã€ä»£ç ç¼–å†™ã€ä»»åŠ¡è§„åˆ’

### æ•°æ®æµæ¶æ„

```
ç”¨æˆ·è¾“å…¥ â†’ æ–‡ä»¶å¼•ç”¨è§£æ â†’ æ™ºèƒ½å·¥å…·é€‰æ‹© â†’ å·¥ä½œæµè·¯ç”±
                                    â†“
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â†“              â†“              â†“
                 å‘½ä»¤æ‰§è¡Œ        æ–‡ä»¶æ“ä½œ        æ™ºèƒ½é—®ç­”
                     â†“              â†“              â†“
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                            ç»“æœç”Ÿæˆ â†’ è®°å¿†å­˜å‚¨
```

---

## ğŸ”§ åŠŸèƒ½æ¨¡å—è¯¦è§£

### 1. æ™ºèƒ½æ–‡ä»¶å¼•ç”¨ç³»ç»Ÿ

#### æ ¸å¿ƒæ–‡ä»¶
- `src/ui/file_reference_parser.py` - @ è¯­æ³•è§£æå™¨
- `src/ui/interactive_file_selector.py` - äº¤äº’å¼æ–‡ä»¶é€‰æ‹©å™¨
- `src/ui/smart_file_input.py` - IDE é£æ ¼æ™ºèƒ½è¾“å…¥

#### å®ç°åŸç†
1. **@ è¯­æ³•è§£æ**: ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¯†åˆ« `@filename` æ¨¡å¼
2. **æ™ºèƒ½åŒ¹é…**: æ”¯æŒæ¨¡ç³Šæœç´¢ã€é€šé…ç¬¦ã€ç›¸å¯¹/ç»å¯¹è·¯å¾„
3. **äº¤äº’å¼é€‰æ‹©**: æä¾›åˆ†é¡µæµè§ˆã€å®æ—¶æœç´¢ã€æ•°å­—å¿«é€‰
4. **IDE é£æ ¼è¡¥å…¨**: å®æ—¶è‡ªåŠ¨è¡¥å…¨ï¼Œä¸Šä¸‹ç®­å¤´å¯¼èˆªï¼ŒTab é”®è¡¥å…¨

#### æ”¯æŒçš„è¯­æ³•
```bash
@filename.ext        # æ™ºèƒ½åŒ¹é…æ–‡ä»¶å
@./path/file.ext     # ç›¸å¯¹è·¯å¾„
@/absolute/path      # ç»å¯¹è·¯å¾„
@*.py                # é€šé…ç¬¦åŒ¹é…
@folder/             # ç›®å½•å¼•ç”¨
```

#### å·¥ä½œæµç¨‹
```
ç”¨æˆ·è¾“å…¥ @ â†’ è§£ææ–‡ä»¶å¼•ç”¨ â†’ æ™ºèƒ½åŒ¹é… â†’ è¯»å–æ–‡ä»¶å†…å®¹ â†’ æ·»åŠ åˆ°ä¸Šä¸‹æ–‡
```

### 2. MCP é›†æˆç³»ç»Ÿ

#### æ ¸å¿ƒæ–‡ä»¶
- `src/mcp/mcp_manager.py` - MCP æœåŠ¡å™¨ç®¡ç†å™¨
- `src/mcp/agent_tool_calling.py` - æ™ºèƒ½å·¥å…·è°ƒç”¨
- `src/mcp/mcp_filesystem.py` - æ–‡ä»¶ç³»ç»Ÿå·¥å…·
- `mcp_config.json` - MCP é…ç½®æ–‡ä»¶

#### å®ç°åŸç†
1. **ç»Ÿä¸€å·¥å…·æ³¨å†Œè¡¨**: å°†æ‰€æœ‰å·¥å…·ï¼ˆå†…ç½®ã€MCPã€LangChainï¼‰ç»Ÿä¸€ç®¡ç†
2. **é›¶åˆ†æ”¯è‡ªåŠ¨åˆ†å‘**: é€šè¿‡å·¥å…·ç±»å‹è‡ªåŠ¨è·¯ç”±åˆ°å¯¹åº”çš„æ‰§è¡Œå™¨
3. **ç¼“å­˜ä¼˜åŒ–**: å·¥å…·åˆ—è¡¨ç¼“å­˜ï¼Œåå°å¼‚æ­¥åˆ·æ–°
4. **æ™ºèƒ½å·¥å…·é€‰æ‹©**: LLM è‡ªä¸»åˆ†ææ„å›¾å¹¶é€‰æ‹©åˆé€‚çš„å·¥å…·

#### å·¥å…·ç±»å‹
- **å†…ç½®å·¥å…·**: æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆè¯»å–ã€å†™å…¥ã€åˆ—è¡¨ç­‰ï¼‰
- **MCP å·¥å…·**: å¤–éƒ¨ MCP æœåŠ¡å™¨æä¾›çš„å·¥å…·
- **LangChain å·¥å…·**: å¾…åŠç®¡ç†ã€Git æ“ä½œã€æ•°æ®è½¬æ¢ç­‰

#### è°ƒç”¨æµç¨‹
```
ç”¨æˆ·è¯·æ±‚ â†’ LLM åˆ†ææ„å›¾ â†’ é€‰æ‹©å·¥å…· â†’ ç»Ÿä¸€è°ƒç”¨æ¥å£ â†’ æ‰§è¡Œå·¥å…· â†’ è¿”å›ç»“æœ
```

### 3. Git æ™ºèƒ½å·¥å…·ç³»ç»Ÿ

#### æ ¸å¿ƒæ–‡ä»¶
- `src/tools/git_tools.py` - Git åŸºç¡€æ“ä½œ
- `src/tools/git_commit_tools.py` - æ™ºèƒ½ commit æ¶ˆæ¯ç”Ÿæˆ
- `src/tools/auto_commit_tools.py` - è‡ªåŠ¨æäº¤å·¥ä½œæµ
- `src/tools/code_review_tools.py` - ä»£ç å®¡æŸ¥å·¥å…·

#### åŠŸèƒ½ç‰¹æ€§
1. **æ™ºèƒ½ Commit æ¶ˆæ¯**: åŸºäº git diff åˆ†æç”Ÿæˆè¯­ä¹‰åŒ–æäº¤æ¶ˆæ¯
2. **å®Œæ•´å·¥ä½œæµ**: æ”¯æŒ 3 æ­¥éª¤æäº¤å’Œ 5 æ­¥éª¤å®Œæ•´æµç¨‹
3. **è‡ªåŠ¨åˆ†æ”¯è¯†åˆ«**: æ™ºèƒ½è¯†åˆ« dev/main/feature åˆ†æ”¯
4. **ä»£ç å®¡æŸ¥**: AI é©±åŠ¨çš„ä»£ç è´¨é‡åˆ†æ

#### å·¥ä½œæµç±»å‹
- **auto_commit**: `git add` â†’ ç”Ÿæˆæ¶ˆæ¯ â†’ `git commit`
- **full_git_workflow**: `git pull` â†’ `git add` â†’ ç”Ÿæˆæ¶ˆæ¯ â†’ `git commit` â†’ `git push`
- **å•ç‹¬æ“ä½œ**: æ”¯æŒç‹¬ç«‹çš„ pull/push æ“ä½œ

### 4. å¾…åŠäº‹é¡¹ç®¡ç†ç³»ç»Ÿ

#### æ ¸å¿ƒæ–‡ä»¶
- `src/tools/todo_manager.py` - å¾…åŠäº‹é¡¹ç®¡ç†å™¨
- `src/tools/todo_tools.py` - LangChain å·¥å…·å°è£…

#### å®ç°ç‰¹æ€§
1. **æŒ‰æ—¥æœŸå­˜å‚¨**: æ¯æ—¥ç‹¬ç«‹çš„ JSON æ–‡ä»¶å­˜å‚¨
2. **æ™ºèƒ½è§£æ**: è‡ªç„¶è¯­è¨€è¯†åˆ«æ—¶é—´å’Œå†…å®¹
3. **çŠ¶æ€ç®¡ç†**: æ”¯æŒå¾…åŠçŠ¶æ€è·Ÿè¸ª
4. **æœç´¢åŠŸèƒ½**: æ”¯æŒå†…å®¹æœç´¢å’Œæ—¥æœŸèŒƒå›´æŸ¥è¯¢

#### æ•°æ®ç»“æ„
```json
{
  "date": "2025-10-24",
  "todos": [
    {
      "id": "uuid",
      "time": "18:00",
      "content": "ç»™é™ˆé¾™æ‰“ç”µè¯",
      "status": "pending",
      "created_at": "2025-10-24 10:30:00"
    }
  ]
}
```

### 5. æ•°æ®è½¬æ¢å·¥å…·ç³»ç»Ÿ

#### æ ¸å¿ƒæ–‡ä»¶
- `src/tools/data_converter_tools.py` - æ•°æ®æ ¼å¼è½¬æ¢å·¥å…·

#### æ”¯æŒæ ¼å¼
- JSON â†” CSV
- JSON â†” YAML
- JSON â†” XML
- CSV â†” YAML
- æ ¼å¼éªŒè¯å’Œç¾åŒ–

#### è½¬æ¢æµç¨‹
```
æ£€æµ‹è¾“å…¥æ ¼å¼ â†’ è§£ææ•°æ® â†’ è½¬æ¢æ ¼å¼ â†’ éªŒè¯è¾“å‡º â†’ è¿”å›ç»“æœ
```

### 6. ç¯å¢ƒè¯Šæ–­ç³»ç»Ÿ

#### æ ¸å¿ƒæ–‡ä»¶
- `src/tools/env_diagnostic_tools.py` - ç¯å¢ƒè¯Šæ–­å·¥å…·

#### è¯Šæ–­é¡¹ç›®
1. **Python ç¯å¢ƒ**: ç‰ˆæœ¬ã€è™šæ‹Ÿç¯å¢ƒã€åŒ…ç®¡ç†å™¨
2. **å¼€å‘å·¥å…·**: Gitã€Node.jsã€Docker ç­‰
3. **ä¾èµ–æ£€æŸ¥**: requirements.txtã€package.json ç­‰
4. **é…ç½®æ–‡ä»¶**: ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶å®Œæ•´æ€§

### 7. å¯¹è¯è®°å¿†ç³»ç»Ÿ

#### æ ¸å¿ƒæ–‡ä»¶
- `src/core/agent_memory.py` - å¯¹è¯å†å²ç®¡ç†

#### å®ç°ç‰¹æ€§
1. **ä¸Šä¸‹æ–‡ä¿æŒ**: è®°ä½å¯¹è¯å†å²å’Œå‘½ä»¤æ‰§è¡Œç»“æœ
2. **æ™ºèƒ½æ‘˜è¦**: é•¿å¯¹è¯è‡ªåŠ¨æ‘˜è¦ï¼Œé¿å…ä¸Šä¸‹æ–‡æº¢å‡º
3. **æ„å›¾å…³è”**: æ ¹æ®æ„å›¾ç±»å‹ä¼˜åŒ–è®°å¿†å­˜å‚¨
4. **æŒä¹…åŒ–å­˜å‚¨**: æ”¯æŒä¼šè¯é—´çš„è®°å¿†ä¿æŒ

---

## ğŸ”„ å·¥ä½œæµç¨‹

### ä¸»å·¥ä½œæµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B[æ–‡ä»¶å¼•ç”¨å¤„ç†]
    B --> C[æ™ºèƒ½å·¥å…·é€‰æ‹©]
    C --> D{æ„å›¾è·¯ç”±}
    
    D -->|ç»ˆç«¯å‘½ä»¤| E[å‘½ä»¤ç”Ÿæˆ]
    D -->|å¤šæ­¥éª¤| F[æ­¥éª¤è§„åˆ’]
    D -->|é—®ç­”| G[æ™ºèƒ½é—®ç­”]
    D -->|å·¥å…·è°ƒç”¨| H[å·¥å…·æ‰§è¡Œ]
    D -->|Git æ“ä½œ| I[Git å·¥ä½œæµ]
    
    E --> J[å‘½ä»¤æ‰§è¡Œ]
    F --> K[å¤šå‘½ä»¤æ‰§è¡Œ]
    G --> L[æµå¼è¾“å‡º]
    H --> M[ç»“æœæ ¼å¼åŒ–]
    I --> N[Git æ­¥éª¤æ‰§è¡Œ]
    
    J --> O[å“åº”æ ¼å¼åŒ–]
    K --> O
    L --> P[è®°å¿†å­˜å‚¨]
    M --> P
    N --> P
    O --> P
```

### Git å·¥ä½œæµè¯¦è§£

#### è‡ªåŠ¨æäº¤å·¥ä½œæµ (auto_commit)
```
1. git add . (æš‚å­˜æ‰€æœ‰å˜æ›´)
2. åˆ†æ git diff ç”Ÿæˆ commit æ¶ˆæ¯
3. git commit -m "æ¶ˆæ¯"
```

#### å®Œæ•´ Git å·¥ä½œæµ (full_git_workflow)
```
1. git pull (æ‹‰å–æœ€æ–°ä»£ç )
2. git add . (æš‚å­˜æ‰€æœ‰å˜æ›´)
3. åˆ†æ git diff ç”Ÿæˆ commit æ¶ˆæ¯
4. git commit -m "æ¶ˆæ¯"
5. git push (æ¨é€åˆ°è¿œç¨‹)
```

### å·¥å…·é€‰æ‹©æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B[LLM æ„å›¾åˆ†æ]
    B --> C{å·¥å…·ç±»å‹åˆ¤æ–­}
    
    C -->|å¾…åŠç®¡ç†| D[todo_tools]
    C -->|Git æ“ä½œ| E[git_tools]
    C -->|æ•°æ®è½¬æ¢| F[data_converter]
    C -->|ç¯å¢ƒè¯Šæ–­| G[env_diagnostic]
    C -->|æ–‡ä»¶æ“ä½œ| H[filesystem_tools]
    C -->|å…¶ä»– MCP| I[mcp_tools]
    
    D --> J[æ‰§è¡Œå·¥å…·]
    E --> J
    F --> J
    G --> J
    H --> J
    I --> J
    
    J --> K[æ ¼å¼åŒ–ç»“æœ]
    K --> L[è¿”å›å“åº”]
```

---

## ğŸ’» æŠ€æœ¯å®ç°

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

- **æ¡†æ¶**: LangGraph + LangChain
- **LLM**: Kimi-K2 (é€šç”¨) + Claude-3.5-Sonnet (ä»£ç )
- **åè®®**: MCP (Model Context Protocol)
- **è¯­è¨€**: Python 3.8+
- **UI**: prompt_toolkit (äº¤äº’å¼ç•Œé¢)

### å…³é”®è®¾è®¡æ¨¡å¼

#### 1. çŠ¶æ€æœºæ¨¡å¼ (LangGraph)
ä½¿ç”¨ LangGraph çš„çŠ¶æ€å›¾æ¨¡å¼ç®¡ç†å¤æ‚çš„å·¥ä½œæµç¨‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ç‰¹å®šçš„å¤„ç†é€»è¾‘ã€‚

#### 2. å·¥å…·æ³¨å†Œè¡¨æ¨¡å¼
ç»Ÿä¸€çš„å·¥å…·æ³¨å†Œè¡¨ç®¡ç†æ‰€æœ‰å·¥å…·ï¼Œæ”¯æŒåŠ¨æ€æ³¨å†Œå’Œé›¶åˆ†æ”¯è°ƒç”¨ã€‚

#### 3. åŒ LLM ç­–ç•¥æ¨¡å¼
æ ¹æ®ä»»åŠ¡ç±»å‹é€‰æ‹©åˆé€‚çš„ LLMï¼Œä¼˜åŒ–æ€§èƒ½å’Œæˆæœ¬ã€‚

#### 4. æ’ä»¶åŒ–æ¶æ„
é€šè¿‡ MCP åè®®æ”¯æŒå¤–éƒ¨å·¥å…·é›†æˆï¼Œå®ç°åŠŸèƒ½çš„å¯æ‰©å±•æ€§ã€‚

### æ•°æ®ç»“æ„è®¾è®¡

#### AgentState (å·¥ä½œæµçŠ¶æ€)
```python
@dataclass
class AgentState:
    user_input: str                    # ç”¨æˆ·è¾“å…¥
    intent: str                        # æ„å›¾ç±»å‹
    response: str                      # å“åº”å†…å®¹
    file_contents: Dict[str, str]      # æ–‡ä»¶å†…å®¹
    referenced_files: List[Dict]       # å¼•ç”¨çš„æ–‡ä»¶
    commands: List[str]                # ç”Ÿæˆçš„å‘½ä»¤
    execution_results: List[Dict]      # æ‰§è¡Œç»“æœ
    mcp_context: Optional[MCPContext]  # MCP ä¸Šä¸‹æ–‡
    todo_data: Optional[TodoData]      # å¾…åŠæ•°æ®
    git_data: Optional[GitData]        # Git æ•°æ®
    error: Optional[str]               # é”™è¯¯ä¿¡æ¯
```

#### æ–‡ä»¶å¼•ç”¨ç»“æ„
```python
@dataclass
class FileReference:
    original_text: str        # åŸå§‹æ–‡æœ¬
    file_path: str           # æ–‡ä»¶è·¯å¾„
    exists: bool             # æ˜¯å¦å­˜åœ¨
    is_directory: bool       # æ˜¯å¦ä¸ºç›®å½•
    match_confidence: float  # åŒ¹é…ç½®ä¿¡åº¦
```

---

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
dnm/                              # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ dnm                           # ä¸»å…¥å£æ–‡ä»¶ (å¯æ‰§è¡Œ)
â”œâ”€â”€ src/                          # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ agent_config.py       # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ agent_workflow.py     # å·¥ä½œæµå®šä¹‰
â”‚   â”‚   â”œâ”€â”€ agent_nodes.py        # èŠ‚ç‚¹å®ç°
â”‚   â”‚   â”œâ”€â”€ agent_memory.py       # è®°å¿†ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ agent_llm.py          # LLM ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ agent_utils.py        # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ agent_types.py        # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ ui/                       # ç”¨æˆ·ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ agent_ui.py           # ä¸»ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ input_handlers.py     # è¾“å…¥å¤„ç†
â”‚   â”‚   â”œâ”€â”€ smart_file_input.py   # æ™ºèƒ½æ–‡ä»¶è¾“å…¥
â”‚   â”‚   â”œâ”€â”€ interactive_file_selector.py  # æ–‡ä»¶é€‰æ‹©å™¨
â”‚   â”‚   â””â”€â”€ file_reference_parser.py      # æ–‡ä»¶å¼•ç”¨è§£æ
â”‚   â”œâ”€â”€ mcp/                      # MCP é›†æˆ
â”‚   â”‚   â”œâ”€â”€ mcp_manager.py        # MCP ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ agent_tool_calling.py # å·¥å…·è°ƒç”¨
â”‚   â”‚   â””â”€â”€ mcp_filesystem.py     # æ–‡ä»¶ç³»ç»Ÿå·¥å…·
â”‚   â””â”€â”€ tools/                    # å·¥å…·æ¨¡å—
â”‚       â”œâ”€â”€ todo_manager.py       # å¾…åŠç®¡ç†
â”‚       â”œâ”€â”€ todo_tools.py         # å¾…åŠå·¥å…·
â”‚       â”œâ”€â”€ git_tools.py          # Git å·¥å…·
â”‚       â”œâ”€â”€ git_commit_tools.py   # Git æäº¤å·¥å…·
â”‚       â”œâ”€â”€ auto_commit_tools.py  # è‡ªåŠ¨æäº¤
â”‚       â”œâ”€â”€ code_review_tools.py  # ä»£ç å®¡æŸ¥
â”‚       â”œâ”€â”€ data_converter_tools.py  # æ•°æ®è½¬æ¢
â”‚       â””â”€â”€ env_diagnostic_tools.py  # ç¯å¢ƒè¯Šæ–­
â”œâ”€â”€ docs/                         # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ test/                         # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ mcp_config.json              # MCP é…ç½®
â”œâ”€â”€ requirements.txt             # Python ä¾èµ–
â””â”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
```

### æ·»åŠ æ–°åŠŸèƒ½

#### 1. æ·»åŠ æ–°å·¥å…·
```python
# 1. åœ¨ src/tools/ ä¸‹åˆ›å»ºå·¥å…·æ–‡ä»¶
# 2. å®ç°å·¥å…·å‡½æ•°
def my_tool_func(input_str: str) -> str:
    """å·¥å…·åŠŸèƒ½å®ç°"""
    pass

# 3. åˆ›å»º LangChain Tool
my_tool = Tool(
    name="my_tool",
    description="å·¥å…·æè¿°",
    func=my_tool_func
)

# 4. åœ¨ mcp_manager.py ä¸­æ³¨å†Œå·¥å…·
def _register_langchain_tools(self):
    self.tool_registry["my_tool"] = {
        "name": "my_tool",
        "description": "å·¥å…·æè¿°",
        "type": "builtin",
        "func": my_tool_func,
        "parameters": {...}
    }
```

#### 2. æ·»åŠ æ–°èŠ‚ç‚¹
```python
# 1. åœ¨ agent_nodes.py ä¸­æ·»åŠ èŠ‚ç‚¹å‡½æ•°
def my_new_node(state: AgentState) -> dict:
    """æ–°èŠ‚ç‚¹å®ç°"""
    # å¤„ç†é€»è¾‘
    return {"response": "å¤„ç†ç»“æœ"}

# 2. åœ¨ agent_workflow.py ä¸­æ³¨å†ŒèŠ‚ç‚¹
workflow.add_node("my_new_node", my_new_node)

# 3. æ·»åŠ è·¯ç”±é€»è¾‘
def route_to_new_node(state: AgentState) -> str:
    if state["intent"] == "my_intent":
        return "my_new_node"
    return "default_node"
```

#### 3. æ‰©å±•æ„å›¾è¯†åˆ«
```python
# åœ¨ agent_tool_calling.py çš„ simple_tool_calling_node ä¸­
# æ·»åŠ æ–°çš„æ„å›¾åˆ¤æ–­é€»è¾‘
if "å…³é”®è¯" in user_input.lower():
    return {
        "intent": "new_intent",
        "response": "å¤„ç†ç»“æœ"
    }
```

### é…ç½®ç®¡ç†

#### LLM é…ç½®
```python
# src/core/agent_config.py
LLM_CONFIG = {
    "model": "kimi-k2-0905-preview",
    "base_url": "https://api.moonshot.cn/v1",
    "api_key": "your-api-key",
    "temperature": 0,
}

LLM_CONFIG2 = {
    "model": "claude-3-5-sonnet",
    "base_url": "https://your-proxy/v1",
    "api_key": "your-api-key",
    "temperature": 0,
}
```

#### MCP é…ç½®
```json
{
  "servers": {
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/workspace"],
      "description": "æ–‡ä»¶ç³»ç»Ÿæ“ä½œå·¥å…·"
    }
  }
}
```

### æµ‹è¯•å’Œè°ƒè¯•

#### è¿è¡Œæµ‹è¯•
```bash
# åŠŸèƒ½æµ‹è¯•
python test/test_new_features.py

# é›†æˆæµ‹è¯•
python test/test_integration.py

# å·¥ä½œæµæµ‹è¯•
python test/agent_workflow_v2.py
```

#### è°ƒè¯•æŠ€å·§
1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**: åœ¨èŠ‚ç‚¹ä¸­æ·»åŠ  `print` è¯­å¥è·Ÿè¸ªæ‰§è¡Œæµç¨‹
2. **çŠ¶æ€æ£€æŸ¥**: åœ¨å…³é”®èŠ‚ç‚¹æ£€æŸ¥ `state` çš„å†…å®¹
3. **å·¥å…·æµ‹è¯•**: å•ç‹¬æµ‹è¯•å·¥å…·å‡½æ•°çš„è¾“å…¥è¾“å‡º
4. **MCP è°ƒè¯•**: æ£€æŸ¥ MCP æœåŠ¡å™¨çš„è¿æ¥å’Œå“åº”

### æ€§èƒ½ä¼˜åŒ–

#### 1. ç¼“å­˜ç­–ç•¥
- MCP å·¥å…·åˆ—è¡¨ç¼“å­˜ (24å°æ—¶)
- æ–‡ä»¶å†…å®¹ç¼“å­˜ (ä¼šè¯çº§åˆ«)
- LLM å“åº”ç¼“å­˜ (ç›¸åŒè¾“å…¥)

#### 2. å¼‚æ­¥å¤„ç†
- MCP å·¥å…·å‘ç°å¼‚æ­¥æ‰§è¡Œ
- æ–‡ä»¶è¯»å–å¹¶å‘å¤„ç†
- é•¿æ—¶é—´å‘½ä»¤åå°æ‰§è¡Œ

#### 3. å†…å­˜ç®¡ç†
- å¯¹è¯å†å²è‡ªåŠ¨æ¸…ç†
- å¤§æ–‡ä»¶åˆ†å—å¤„ç†
- çŠ¶æ€å¯¹è±¡åŠæ—¶é‡Šæ”¾

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](README.md) - é¡¹ç›®ä¸»æ–‡æ¡£å’Œå¿«é€Ÿå¼€å§‹
- [docs/INSTALLATION_GUIDE.md](docs/INSTALLATION_GUIDE.md) - è¯¦ç»†å®‰è£…æŒ‡å—
- [docs/QUICK_START.md](docs/QUICK_START.md) - å¿«é€Ÿå¼€å§‹æ•™ç¨‹
- [docs/MCP_INTEGRATION_SUMMARY.md](docs/MCP_INTEGRATION_SUMMARY.md) - MCP é›†æˆè¯¦è§£
- [docs/GIT_FULL_WORKFLOW_SUMMARY.md](docs/GIT_FULL_WORKFLOW_SUMMARY.md) - Git å·¥ä½œæµè¯¦è§£
- [docs/FILE_REFERENCE_UPGRADE_SUMMARY.md](docs/FILE_REFERENCE_UPGRADE_SUMMARY.md) - æ–‡ä»¶å¼•ç”¨åŠŸèƒ½è¯¦è§£

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¼€å‘æµç¨‹
1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯: `git checkout -b feature/new-feature`
3. æäº¤æ›´æ”¹: `git commit -m "Add new feature"`
4. æ¨é€åˆ†æ”¯: `git push origin feature/new-feature`
5. åˆ›å»º Pull Request

### ä»£ç è§„èŒƒ
- éµå¾ª PEP 8 ä»£ç é£æ ¼
- ä½¿ç”¨ç±»å‹æ³¨è§£
- æ·»åŠ è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²
- ä¿æŒå‡½æ•°ç®€æ´ï¼Œå•ä¸€èŒè´£
- ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å’Œå‡½æ•°å

### æäº¤è§„èŒƒ
- `feat:` æ–°åŠŸèƒ½
- `fix:` é”™è¯¯ä¿®å¤
- `docs:` æ–‡æ¡£æ›´æ–°
- `style:` ä»£ç æ ¼å¼è°ƒæ•´
- `refactor:` ä»£ç é‡æ„
- `test:` æµ‹è¯•ç›¸å…³
- `chore:` æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

---

*æœ¬æ–‡æ¡£æŒç»­æ›´æ–°ä¸­ï¼Œå¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æäº¤ Issue æˆ– Pull Requestã€‚*
