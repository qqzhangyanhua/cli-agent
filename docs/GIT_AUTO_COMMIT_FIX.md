# Git è‡ªåŠ¨æäº¤å·¥ä½œæµ - Commit æ¶ˆæ¯è´¨é‡ä¼˜åŒ–

## ğŸ› é—®é¢˜æè¿°

åœ¨åˆå§‹å®ç°ä¸­ï¼Œ`git_commit_message_generator_node` èŠ‚ç‚¹ä½¿ç”¨äº†ä¸€ä¸ª**ç®€åŒ–ç‰ˆçš„ prompt**ï¼Œå¯¼è‡´ç”Ÿæˆçš„ commit æ¶ˆæ¯ä¸å¤Ÿè¯¦ç»†ï¼š

```
âŒ ä¹‹å‰ç”Ÿæˆçš„æ¶ˆæ¯ï¼š
chore: æ¸…ç†é¡¹ç›®ç¼“å­˜æ–‡ä»¶å¹¶æ›´æ–°éƒ¨åˆ†æ¨¡å—
```

è€Œå•ç‹¬ä½¿ç”¨ `generate_commit` å·¥å…·æ—¶ï¼Œç”±äºä½¿ç”¨äº†è¯¦ç»†çš„ promptï¼Œä¼šç”Ÿæˆæ›´é«˜è´¨é‡çš„æ¶ˆæ¯ï¼š

```
âœ… ä¼˜åŒ–åç”Ÿæˆçš„æ¶ˆæ¯ï¼š
feat: å®ç°Gitè‡ªåŠ¨æäº¤å·¥ä½œæµï¼Œæ·»åŠ ä¸‰æ­¥éª¤æµæ°´çº¿å¤„ç†

- æ–°å¢auto_commit_tools.pyæ¨¡å—ï¼Œå®ç°git add/commitè‡ªåŠ¨åŒ–
- æ·»åŠ 3ä¸ªLangGraphèŠ‚ç‚¹å¤„ç†æš‚å­˜ã€ç”Ÿæˆæ¶ˆæ¯ã€æ‰§è¡Œæäº¤
- æ›´æ–°install.pyåŒ…å«æ–°æ¨¡å—åˆ°å®‰è£…åˆ—è¡¨
- æ·»åŠ è¯¦ç»†æ–‡æ¡£å’Œæµ‹è¯•è„šæœ¬
```

## ğŸ” æ ¹æœ¬åŸå› 

### é—®é¢˜ä»£ç ï¼ˆagent_nodes.py 1337-1358 è¡Œï¼‰

```python
# ç®€åŒ–ç‰ˆ prompt - ç¼ºå°‘è¯¦ç»†çš„åˆ†ææŒ‡å¯¼
prompt = f"""ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„Git commitæ¶ˆæ¯ç”Ÿæˆå™¨ã€‚åŸºäºä¸‹é¢çš„ä»£ç å˜æ›´ï¼Œç”Ÿæˆç®€æ´ã€ç²¾ç¡®çš„commitæ¶ˆæ¯ã€‚

ğŸ“Š å˜æ›´ç»Ÿè®¡:
- æ€»è®¡: {len(analysis['files_changed'])} ä¸ªæ–‡ä»¶ ({file_stats_str})

ğŸ“„ ä»£ç å˜æ›´å†…å®¹:
```diff
{diff_content}
```

ğŸ¯ è¦æ±‚:
1. éµå¾ª Conventional Commits è§„èŒƒ
2. ä½¿ç”¨ä¸­æ–‡æè¿°
3. æ ¼å¼: <type>: <subject>
4. typeé€‰æ‹©: feat/fix/refactor/docs/perf/test/chore
5. subjectè¦å…·ä½“æè¿°å˜æ›´å†…å®¹

åªè¿”å›ä¸€è¡Œcommitæ¶ˆæ¯ï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚"""
```

### å¯¹æ¯”ï¼šgit_commit_tools.py ä¸­çš„è¯¦ç»† prompt

`git_commit_tools.py` ä¸­æœ‰ä¸€ä¸ª**è¶…è¿‡ 130 è¡Œçš„è¯¦ç»† prompt**ï¼ŒåŒ…æ‹¬ï¼š

1. âœ… **è¯¦ç»†çš„æ–‡ä»¶åˆ†ç±»ç»Ÿè®¡**
   - åˆ†åˆ«åˆ—å‡ºåˆ é™¤/ä¿®æ”¹/æ–°å¢çš„æ–‡ä»¶ï¼ˆæœ€å¤š 20 ä¸ªï¼‰
   - ç²¾ç¡®çš„æ–‡ä»¶æ•°é‡ç»Ÿè®¡

2. âœ… **4 æ­¥åˆ†ææ¡†æ¶**
   ```
   ç¬¬1æ­¥ï¼šæ–‡ä»¶å˜æ›´ç»Ÿè®¡åˆ†æ
   ç¬¬2æ­¥ï¼šä»£ç diffæ·±åº¦åˆ†æï¼ˆå…³é”®ï¼ï¼‰
   ç¬¬3æ­¥ï¼šè¯†åˆ«æ ¸å¿ƒå˜æ›´æ„å›¾
   ç¬¬4æ­¥ï¼šç”Ÿæˆcommitæ¶ˆæ¯
   ```

3. âœ… **å¥½åç¤ºä¾‹å¯¹æ¯”**
   ```
   âœ… å¥½çš„commitæ¶ˆæ¯ç¤ºä¾‹ï¼š
   feat: æ·»åŠ Todoç®¡ç†å·¥å…·å¹¶é›†æˆLangChain Toolæ¥å£
   
   âŒ ä¸å¥½çš„ç¤ºä¾‹ï¼š
   feat: æ·»åŠ æ–°åŠŸèƒ½
   ```

4. âœ… **ç‰¹åˆ«æ³¨æ„äº‹é¡¹**
   - ä¸è¦åªçœ‹æ–‡ä»¶åï¼å¿…é¡»çœ‹diffå†…å®¹
   - å¦‚æœåˆ é™¤äº†å¾ˆå¤šæ–‡æ¡£ï¼Œå¿…é¡»è¯´æ˜å…·ä½“æ•°é‡å’Œç±»å‹
   - å¦‚æœä¿®æ”¹äº†æ ¸å¿ƒæ¨¡å—ï¼Œå¿…é¡»è¯´æ˜ä¿®æ”¹äº†ä»€ä¹ˆè¡Œä¸º/é€»è¾‘

5. âœ… **è¾“å‡ºæ ¼å¼è¦æ±‚**
   - ç®€å•å˜æ›´ï¼šåªè¿”å›ä¸€è¡Œ
   - å¤æ‚å˜æ›´ï¼ˆâ‰¥10ä¸ªæ–‡ä»¶ï¼‰ï¼šè¿”å›å¤šè¡Œæ ¼å¼ï¼ˆsubject + bodyï¼‰

## âœ… è§£å†³æ–¹æ¡ˆ

### é‡æ„ç­–ç•¥

ä¸å†åœ¨èŠ‚ç‚¹ä¸­é‡å¤å®ç°ç”Ÿæˆé€»è¾‘ï¼Œè€Œæ˜¯**ç›´æ¥å¤ç”¨** `git_commit_tools.py` ä¸­å·²ç»ä¼˜åŒ–å¥½çš„å‡½æ•°ï¼š

```python
from git_commit_tools import generate_commit_message_tool_func

def git_commit_message_generator_node(state: AgentState) -> dict:
    """
    Git å·¥ä½œæµèŠ‚ç‚¹ 2: ç”Ÿæˆ commit æ¶ˆæ¯
    
    æ³¨æ„ï¼šå¤ç”¨ git_commit_tools.py ä¸­çš„è¯¦ç»† prompt å’Œç”Ÿæˆé€»è¾‘
    """
    print(f"\nğŸ’¡ [Git å·¥ä½œæµ 2/3] ç”Ÿæˆ commit æ¶ˆæ¯...")
    
    try:
        # ç›´æ¥è°ƒç”¨ git_commit_tools ä¸­çš„ç”Ÿæˆå‡½æ•°
        # è¿™ä¸ªå‡½æ•°åŒ…å«äº†è¯¦ç»†çš„ prompt å’Œ 4 æ­¥åˆ†ææ¡†æ¶
        result_text = generate_commit_message_tool_func("")
        
        # è§£æç»“æœï¼Œæå– commit æ¶ˆæ¯
        if "âŒ" in result_text:
            # å¤„ç†å¤±è´¥æƒ…å†µ
            ...
        
        # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä»ç»“æœä¸­æå– commit æ¶ˆæ¯
        import re
        if 'git commit -m "' in result_text:
            match = re.search(r'git commit -m "([^"]+)"', result_text)
            if match:
                commit_message = match.group(1)
        
        return {
            "git_commit_message_generated": True,
            "git_commit_message": commit_message,
            ...
        }
    except Exception as e:
        ...
```

### å…³é”®æ”¹è¿›ç‚¹

1. âœ… **ä»£ç å¤ç”¨** - é¿å…é‡å¤å®ç°ç›¸åŒé€»è¾‘
2. âœ… **ä¸€è‡´æ€§** - ç¡®ä¿æ‰€æœ‰åœ°æ–¹ä½¿ç”¨ç›¸åŒçš„é«˜è´¨é‡ prompt
3. âœ… **å¯ç»´æŠ¤æ€§** - åªéœ€è¦åœ¨ä¸€ä¸ªåœ°æ–¹ï¼ˆgit_commit_tools.pyï¼‰æ›´æ–° prompt
4. âœ… **è´¨é‡ä¿è¯** - ä½¿ç”¨å·²ç»éªŒè¯è¿‡çš„è¯¦ç»†åˆ†ææ¡†æ¶

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰ï¼ˆç®€åŒ– promptï¼‰

```
è¾“å…¥: dnm æäº¤ä»£ç 

è¾“å‡º:
âœ… å·²æš‚å­˜ 64 ä¸ªæ–‡ä»¶
âœ… ç”Ÿæˆçš„æ¶ˆæ¯: chore: æ¸…ç†é¡¹ç›®ç¼“å­˜æ–‡ä»¶å¹¶æ›´æ–°éƒ¨åˆ†æ¨¡å—
âœ… ä»£ç å·²æäº¤
```

**é—®é¢˜**ï¼š
- âŒ åªè¯´"æ¸…ç†ç¼“å­˜"ï¼Œæ²¡è¯´æ¸…ç†äº†ä»€ä¹ˆ
- âŒ "æ›´æ–°éƒ¨åˆ†æ¨¡å—"å¤ªç¬¼ç»Ÿï¼Œæ²¡è¯´æ›´æ–°äº†ä»€ä¹ˆ

### ä¿®å¤åï¼ˆè¯¦ç»† promptï¼‰

```
è¾“å…¥: dnm æäº¤ä»£ç 

è¾“å‡º:
âœ… å·²æš‚å­˜ 64 ä¸ªæ–‡ä»¶
âœ… ç”Ÿæˆçš„æ¶ˆæ¯: feat: å®ç°Gitè‡ªåŠ¨æäº¤å·¥ä½œæµå¹¶ä¼˜åŒ–commitæ¶ˆæ¯ç”Ÿæˆ

- æ–°å¢auto_commit_tools.pyæ¨¡å—ï¼Œå°è£…git addã€commitå‡½æ•°
- æ·»åŠ 3ä¸ªLangGraphå·¥ä½œæµèŠ‚ç‚¹ï¼ˆæš‚å­˜ã€ç”Ÿæˆæ¶ˆæ¯ã€æ‰§è¡Œæäº¤ï¼‰
- é‡æ„git_commit_message_generator_nodeï¼Œå¤ç”¨è¯¦ç»†prompt
- æ›´æ–°install.pyæ¨¡å—åˆ—è¡¨ï¼ŒåŒ…å«æ–°çš„auto_commit_tools
- æ·»åŠ å®Œæ•´æ–‡æ¡£ï¼ˆå·¥ä½œæµã€å¿«é€Ÿå¼€å§‹ã€æ¼”ç¤ºï¼‰

âœ… ä»£ç å·²æäº¤
```

**æ”¹è¿›**ï¼š
- âœ… å‡†ç¡®çš„ typeï¼ˆfeat è€Œé choreï¼‰
- âœ… è¯¦ç»†çš„ subject è¯´æ˜åŠŸèƒ½
- âœ… å®Œæ•´çš„ body åˆ—å‡ºæ‰€æœ‰å…³é”®å˜æ›´
- âœ… å…·ä½“è¯´æ˜äº†æ–°å¢/ä¿®æ”¹/æ·»åŠ äº†ä»€ä¹ˆ

## ğŸ¯ æœ€ä½³å®è·µ

### 1. é¿å…é‡å¤å®ç°

å½“å·²ç»æœ‰ä¼˜åŒ–å¥½çš„å·¥å…·å‡½æ•°æ—¶ï¼Œåº”è¯¥ç›´æ¥å¤ç”¨ï¼Œè€Œä¸æ˜¯é‡æ–°å®ç°ç®€åŒ–ç‰ˆï¼š

```python
âŒ ä¸å¥½çš„åšæ³•ï¼š
def my_node():
    # é‡æ–°å®ç°ç®€åŒ–ç‰ˆé€»è¾‘
    prompt = "ç®€å•çš„prompt"
    result = llm.invoke(prompt)
    ...

âœ… å¥½çš„åšæ³•ï¼š
from existing_tools import optimized_function

def my_node():
    # ç›´æ¥å¤ç”¨å·²ä¼˜åŒ–çš„å‡½æ•°
    result = optimized_function()
    ...
```

### 2. ä¿æŒä¸€è‡´æ€§

æ‰€æœ‰ç”Ÿæˆ commit æ¶ˆæ¯çš„åœ°æ–¹éƒ½åº”è¯¥ä½¿ç”¨ç›¸åŒçš„é«˜è´¨é‡ promptï¼š

```python
âœ… ç»Ÿä¸€çš„å…¥å£ï¼š
git_commit_tools.generate_commit_message_tool_func()
  â†‘
  â”œâ”€ agent_tool_calling.py (generate_commit å·¥å…·)
  â”œâ”€ agent_nodes.py (git_commit_message_generator_node)
  â””â”€ auto_commit_tools.py (auto_commit_tool_func)
```

### 3. å•ä¸€èŒè´£åŸåˆ™

```
git_commit_tools.py
â”œâ”€ èŒè´£ï¼šGit commit æ¶ˆæ¯ç”Ÿæˆ
â”œâ”€ åŒ…å«ï¼šè¯¦ç»† promptã€åˆ†ææ¡†æ¶ã€ç¤ºä¾‹
â””â”€ è¢«å¤ç”¨ï¼šæ‰€æœ‰éœ€è¦ç”Ÿæˆ commit æ¶ˆæ¯çš„åœ°æ–¹

agent_nodes.py
â”œâ”€ èŒè´£ï¼šLangGraph å·¥ä½œæµèŠ‚ç‚¹
â”œâ”€ åŒ…å«ï¼šçŠ¶æ€ç®¡ç†ã€èŠ‚ç‚¹é€»è¾‘ã€é”™è¯¯å¤„ç†
â””â”€ å¤ç”¨ï¼šgit_commit_tools çš„ç”Ÿæˆå‡½æ•°
```

## ğŸ”§ å®‰è£…å’Œä½¿ç”¨

### é‡æ–°å®‰è£…

```bash
cd D:\AI\cli-agent
python install.py
```

### æµ‹è¯•æ•ˆæœ

```bash
# ä¿®æ”¹ä¸€äº›æ–‡ä»¶å
dnm æäº¤ä»£ç 

# æˆ–è€…åªç”Ÿæˆæ¶ˆæ¯ï¼ˆä¸æäº¤ï¼‰
dnm ç”Ÿæˆcommitæ—¥å¿—
```

### å¯¹æ¯”æµ‹è¯•

```bash
# 1. ä½¿ç”¨è‡ªåŠ¨æäº¤ï¼ˆ3æ­¥éª¤å·¥ä½œæµï¼‰
dnm æäº¤ä»£ç 

# 2. ä½¿ç”¨å•ç‹¬çš„ç”Ÿæˆå·¥å…·
dnm ç”Ÿæˆcommitæ—¥å¿—

# ä¸¤è€…ç°åœ¨åº”è¯¥ç”Ÿæˆç›¸åŒè´¨é‡çš„æ¶ˆæ¯ï¼
```

## ğŸ“ ç›¸å…³æ–‡ä»¶

ä¿®æ”¹çš„æ–‡ä»¶ï¼š
- `agent_nodes.py` - é‡æ„ `git_commit_message_generator_node`
- `install.py` - æ·»åŠ  `auto_commit_tools.py` åˆ°æ¨¡å—åˆ—è¡¨

ä¾èµ–çš„æ–‡ä»¶ï¼š
- `git_commit_tools.py` - è¯¦ç»† prompt å’Œç”Ÿæˆé€»è¾‘
- `git_tools.py` - Git æ“ä½œå·¥å…·
- `agent_llm.py` - LLM è°ƒç”¨

## ğŸ‰ æ€»ç»“

è¿™æ¬¡ä¼˜åŒ–å±•ç¤ºäº†ï¼š

1. âœ… **ä»£ç å¤ç”¨çš„é‡è¦æ€§** - é¿å…é‡å¤å®ç°
2. âœ… **ä¸€è‡´æ€§çš„ä»·å€¼** - ç»Ÿä¸€ä½¿ç”¨é«˜è´¨é‡çš„å®ç°
3. âœ… **æ¨¡å—åŒ–è®¾è®¡** - æ¯ä¸ªæ¨¡å—æœ‰æ˜ç¡®çš„èŒè´£
4. âœ… **å¿«é€Ÿä¿®å¤é—®é¢˜** - é€šè¿‡é‡æ„æå‡è´¨é‡

ç°åœ¨ `dnm æäº¤ä»£ç ` ä¼šç”Ÿæˆå’Œ `dnm ç”Ÿæˆcommitæ—¥å¿—` ä¸€æ ·è¯¦ç»†ã€ç²¾ç¡®çš„ commit æ¶ˆæ¯äº†ï¼ğŸš€

