# Git å®Œæ•´å·¥ä½œæµåŠŸèƒ½ - æœ€ç»ˆæ€»ç»“

## ğŸ‰ åŠŸèƒ½æ¦‚è¿°

å·²æˆåŠŸå®ç°å®Œæ•´çš„ Git å·¥ä½œæµï¼Œæ”¯æŒ **pull â†’ commit â†’ push** çš„å…¨è‡ªåŠ¨æµç¨‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ™ºèƒ½è¯†åˆ«å½“å‰åˆ†æ”¯ï¼ˆå¦‚ devã€main ç­‰ï¼‰ã€‚

## âœ… å·²å®ç°çš„åŠŸèƒ½

### 1. **æ ¸å¿ƒ Git æ“ä½œ** (`git_tools.py`)

æ–°å¢äº† 4 ä¸ªæ ¸å¿ƒå‡½æ•°ï¼š

```python
def get_current_branch() -> Dict:
    """è·å–å½“å‰åˆ†æ”¯åç§°"""
    # è¿”å›ï¼šmain, dev, feature/xxx ç­‰

def git_pull() -> Dict:
    """æ‰§è¡Œ git pull æ‹‰å–æœ€æ–°ä»£ç """
    # è¿”å›ï¼šæ˜¯å¦æœ‰æ›´æ–°ã€æˆåŠŸçŠ¶æ€

def git_push(branch: Optional[str] = None) -> Dict:
    """æ‰§è¡Œ git push origin <branch>"""
    # è‡ªåŠ¨è¯†åˆ«å½“å‰åˆ†æ”¯
    # è‡ªåŠ¨è®¾ç½®ä¸Šæ¸¸åˆ†æ”¯ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
    # è¿”å›ï¼šæ¨é€ç»“æœ

def analyze_changes() -> Dict:
    """åˆ†æä»£ç å˜æ›´ï¼ˆå·²æœ‰åŠŸèƒ½ï¼Œç”¨äºç”Ÿæˆ commit æ¶ˆæ¯ï¼‰"""
```

### 2. **LangChain å·¥å…·å°è£…** (`auto_commit_tools.py`)

```python
# 3 ä¸ªå·¥å…·å‡½æ•°
git_pull_tool_func()    # Pull å·¥å…·
git_push_tool_func()    # Push å·¥å…·ï¼ˆè‡ªåŠ¨è¯†åˆ«åˆ†æ”¯ï¼‰
auto_commit_tool_func() # åŸæœ‰çš„3æ­¥éª¤æäº¤

# 3 ä¸ª LangChain Tools
git_pull_tool          # ç”¨äºå•ç‹¬ pull
git_push_tool          # ç”¨äºå•ç‹¬ push
auto_commit_tool       # ç”¨äº add -> commit
```

### 3. **LangGraph å·¥ä½œæµèŠ‚ç‚¹** (`agent_nodes.py`)

```python
# 2 ä¸ªæ–°èŠ‚ç‚¹
git_pull_node(state)   # Pull èŠ‚ç‚¹
git_push_node(state)   # Push èŠ‚ç‚¹ï¼ˆè¯»å–åˆ†æ”¯å¹¶æ¨é€ï¼‰

# åŸæœ‰çš„ 3 ä¸ªèŠ‚ç‚¹
git_add_node(state)
git_commit_message_generator_node(state)
git_commit_executor_node(state)
```

### 4. **å®Œæ•´çš„å·¥ä½œæµè·¯ç”±** (`agent_workflow.py`)

æ”¯æŒ **3 ç§ Git å·¥ä½œæµ**ï¼š

#### å·¥ä½œæµ 1: å®Œæ•´æµç¨‹ï¼ˆ5æ­¥éª¤ï¼‰
```
ç”¨æˆ·: "åŒæ­¥å¹¶æäº¤" / "æäº¤å¹¶æ¨é€"
 â†“
pull â†’ add â†’ generate_message â†’ commit â†’ push
```

#### å·¥ä½œæµ 2: åªæäº¤ä¸æ¨é€ï¼ˆ3æ­¥éª¤ï¼‰
```
ç”¨æˆ·: "æäº¤ä»£ç "
 â†“
add â†’ generate_message â†’ commit
```

#### å·¥ä½œæµ 3: å•ç‹¬æ“ä½œ
```
ç”¨æˆ·: "æ‹‰å–ä»£ç "  â†’ åª pull
ç”¨æˆ·: "æ¨é€ä»£ç "  â†’ åª pushï¼ˆè‡ªåŠ¨è¯†åˆ«åˆ†æ”¯ï¼‰
```

### 5. **æ™ºèƒ½æ„å›¾è¯†åˆ«** (`agent_tool_calling.py`)

LLM ä¼šè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å·¥ä½œæµï¼š

| ç”¨æˆ·è¾“å…¥ | è¯†åˆ«å·¥å…· | æ‰§è¡Œæµç¨‹ |
|---------|---------|---------|
| "åŒæ­¥å¹¶æäº¤" | full_git_workflow | 5æ­¥éª¤å®Œæ•´æµç¨‹ |
| "æäº¤å¹¶æ¨é€" | full_git_workflow | 5æ­¥éª¤å®Œæ•´æµç¨‹ |
| "ä¸€é”®åŒæ­¥" | full_git_workflow | 5æ­¥éª¤å®Œæ•´æµç¨‹ |
| "æäº¤ä»£ç " | auto_commit | 3æ­¥éª¤ï¼ˆä¸pushï¼‰ |
| "æ‹‰å–ä»£ç " | git_pull | å•ç‹¬ pull |
| "æ¨é€ä»£ç " | git_push | å•ç‹¬ push |
| "ç”Ÿæˆcommitæ—¥å¿—" | generate_commit | åªç”Ÿæˆæ¶ˆæ¯ |

### 6. **çŠ¶æ€ç®¡ç†** (`agent_config.py`)

æ–°å¢ 4 ä¸ªçŠ¶æ€å­—æ®µï¼š

```python
git_pull_success: bool          # Pull æ˜¯å¦æˆåŠŸ
git_pull_has_updates: bool      # æ˜¯å¦æœ‰æ›´æ–°
git_push_success: bool          # Push æ˜¯å¦æˆåŠŸ
git_push_branch: str            # æ¨é€çš„åˆ†æ”¯å
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. è‡ªåŠ¨åˆ†æ”¯è¯†åˆ«

```bash
# åœºæ™¯1: åœ¨ dev åˆ†æ”¯
> dnm æ¨é€ä»£ç 
[Git Push] å½“å‰åˆ†æ”¯: dev
âœ… å·²æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯ origin/dev

# åœºæ™¯2: åœ¨ main åˆ†æ”¯
> dnm æ¨é€ä»£ç 
[Git Push] å½“å‰åˆ†æ”¯: main
âœ… å·²æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯ origin/main

# åœºæ™¯3: åœ¨ feature åˆ†æ”¯
> dnm åŒæ­¥å¹¶æäº¤
...
âœ… å·²æ¨é€åˆ° origin/feature/user-auth
```

### 2. æ™ºèƒ½ä¸Šæ¸¸åˆ†æ”¯å¤„ç†

å¦‚æœè¿œç¨‹æ²¡æœ‰å¯¹åº”åˆ†æ”¯ï¼Œè‡ªåŠ¨åˆ›å»ºï¼š

```bash
git push --set-upstream origin <branch>
âœ… å·²åˆ›å»ºå¹¶æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯ origin/feature-xxx
```

### 3. è¯¦ç»†çš„æ‰§è¡Œåé¦ˆ

```
ğŸ‰ Git å®Œæ•´å·¥ä½œæµå®Œæˆï¼

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â¬‡ï¸  æ­¥éª¤ 1: âœ… Pull å®Œæˆ (å·²æ˜¯æœ€æ–°)
ğŸ“¦ æ­¥éª¤ 2: âœ… å·²æš‚å­˜ 8 ä¸ªæ–‡ä»¶ (æ–°å¢ 5 ä¸ªã€ä¿®æ”¹ 3 ä¸ª)
ğŸ’¡ æ­¥éª¤ 3: âœ… ç”Ÿæˆ commit æ¶ˆæ¯
  feat: å®ç°Gitå®Œæ•´å·¥ä½œæµï¼Œæ”¯æŒpullå’Œpushè‡ªåŠ¨åˆ†æ”¯è¯†åˆ«
âœï¸  æ­¥éª¤ 4: âœ… ä»£ç å·²æäº¤ (commit: d94830a)
â¬†ï¸  æ­¥éª¤ 5: âœ… å·²æ¨é€åˆ° origin/dev
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ’¡ æç¤º: ä»£ç å·²åŒæ­¥åˆ°è¿œç¨‹ä»“åº“
```

### 4. å®Œå–„çš„é”™è¯¯å¤„ç†

```
âŒ Git å·¥ä½œæµå¤±è´¥

â¬‡ï¸  Pull: âœ… å®Œæˆ
ğŸ“¦ Add: âœ… å®Œæˆ
ğŸ’¡ Commit: âœ… å®Œæˆ (commit: abc1234)
â¬†ï¸  Push: âŒ ç½‘ç»œè¿æ¥å¤±è´¥

ğŸ’¡ å¯ä»¥æ‰‹åŠ¨æ¨é€: git push origin dev
```

## ğŸ“– ä½¿ç”¨æ–¹å¼

### æ–¹å¼ 1: å®Œæ•´å·¥ä½œæµï¼ˆæ¨èï¼‰

```bash
dnm åŒæ­¥å¹¶æäº¤
dnm æäº¤å¹¶æ¨é€
dnm ä¸€é”®åŒæ­¥
```

è‡ªåŠ¨æ‰§è¡Œï¼š
1. â¬‡ï¸  git pull
2. ğŸ“¦ git add .
3. ğŸ’¡ ç”Ÿæˆ commit æ¶ˆæ¯ï¼ˆä½¿ç”¨è¯¦ç»†çš„4æ­¥åˆ†ææ¡†æ¶ï¼‰
4. âœï¸  git commit
5. â¬†ï¸  git push origin \<current_branch>

### æ–¹å¼ 2: åªæäº¤ä¸æ¨é€

```bash
dnm æäº¤ä»£ç 
dnm è‡ªåŠ¨æäº¤
```

æ‰§è¡Œæ­¥éª¤ 2-4ï¼Œä¸æ‰§è¡Œ push

### æ–¹å¼ 3: å•ç‹¬æ“ä½œ

```bash
dnm æ‹‰å–ä»£ç          # git pull
dnm æ¨é€ä»£ç          # git push origin <branch>
dnm ç”Ÿæˆcommitæ—¥å¿—   # åªç”Ÿæˆæ¶ˆæ¯
```

## ğŸ”§ æŠ€æœ¯å®ç°äº®ç‚¹

### 1. å……åˆ†åˆ©ç”¨ LangGraph

**æ¡ä»¶è·¯ç”±**ï¼š
```python
def route_after_commit(state: AgentState) -> str:
    """Commit åè·¯ç”± - åˆ¤æ–­æ˜¯å¦éœ€è¦ push"""
    intent = state.get("intent", "")
    
    if intent == "full_git_workflow":
        # å®Œæ•´å·¥ä½œæµéœ€è¦ç»§ç»­ push
        if state.get("git_commit_success", False):
            return "git_push"
        else:
            return "end"
    else:
        # auto_commit åªåˆ° commitï¼Œä¸ push
        return "end"
```

**å¤šæ­¥éª¤æµæ°´çº¿**ï¼š
```
git_pull â†’ (æˆåŠŸ?) â†’ git_add â†’ (æˆåŠŸ?) â†’ 
generate_message â†’ (æˆåŠŸ?) â†’ commit â†’ (éœ€è¦push?) â†’ 
git_push â†’ END
```

### 2. ä»£ç å¤ç”¨

commit æ¶ˆæ¯ç”Ÿæˆå¤ç”¨äº† `git_commit_tools.py` ä¸­çš„è¯¦ç»† promptï¼ˆ130+ è¡Œçš„4æ­¥åˆ†ææ¡†æ¶ï¼‰ï¼Œç¡®ä¿è´¨é‡ä¸€è‡´ã€‚

### 3. çŠ¶æ€ä¼ é€’

æ¯ä¸ªèŠ‚ç‚¹é€šè¿‡ `AgentState` ä¼ é€’ä¿¡æ¯ï¼š
- `git_files_count` - æš‚å­˜çš„æ–‡ä»¶æ•°
- `git_commit_message` - ç”Ÿæˆçš„æ¶ˆæ¯
- `git_commit_hash` - commit hash
- `git_push_branch` - æ¨é€çš„åˆ†æ”¯

æœ€ç»ˆèŠ‚ç‚¹å¯ä»¥è®¿é—®æ‰€æœ‰å‰ç½®æ­¥éª¤çš„ç»“æœï¼Œç”Ÿæˆå®Œæ•´çš„æ€»ç»“ã€‚

### 4. é”™è¯¯éš”ç¦»

æ¯ä¸ªèŠ‚ç‚¹ç‹¬ç«‹çš„é”™è¯¯å¤„ç†ï¼Œå¤±è´¥æ—¶ï¼š
- æ˜¾ç¤ºå·²å®Œæˆçš„æ­¥éª¤ âœ…
- æ ‡è®°å¤±è´¥çš„æ­¥éª¤ âŒ
- æä¾›æ‰‹åŠ¨æ‰§è¡Œçš„å‘½ä»¤

## ğŸ“¦ å®‰è£…å’Œä½¿ç”¨

### å®‰è£…

```bash
cd D:\AI\cli-agent
python install.py
```

å·²æ›´æ–°ï¼š
- âœ… `install.py` - æ·»åŠ äº† `auto_commit_tools.py` åˆ°æ¨¡å—åˆ—è¡¨
- âœ… `install.sh` - åŒæ­¥æ›´æ–°æ¨¡å—åˆ—è¡¨
- âœ… `README.md` - æ›´æ–°äº†åŠŸèƒ½è¯´æ˜å’Œä½¿ç”¨ç¤ºä¾‹

### æµ‹è¯•

```bash
# æµ‹è¯•å®Œæ•´å·¥ä½œæµ
dnm åŒæ­¥å¹¶æäº¤

# æµ‹è¯•å•ç‹¬æ¨é€ï¼ˆä¼šè‡ªåŠ¨è¯†åˆ«åˆ†æ”¯ï¼‰
dnm æ¨é€ä»£ç 

# æµ‹è¯•åªæäº¤ä¸æ¨é€
dnm æäº¤ä»£ç 
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

1. **[GIT_AUTO_COMMIT_WORKFLOW.md](./GIT_AUTO_COMMIT_WORKFLOW.md)** - è¯¦ç»†çš„æŠ€æœ¯å®ç°æ–‡æ¡£
2. **[GIT_AUTO_COMMIT_QUICK_START.md](./GIT_AUTO_COMMIT_QUICK_START.md)** - å¿«é€Ÿå¼€å§‹æŒ‡å—
3. **[GIT_AUTO_COMMIT_DEMO.md](./GIT_AUTO_COMMIT_DEMO.md)** - åŠŸèƒ½æ¼”ç¤º
4. **[GIT_AUTO_COMMIT_FIX.md](./GIT_AUTO_COMMIT_FIX.md)** - Commit æ¶ˆæ¯è´¨é‡ä¼˜åŒ–

## ğŸ¨ è®¾è®¡ç†å¿µ

### çµæ´»æ€§

æ”¯æŒå¤šç§ä½¿ç”¨åœºæ™¯ï¼š
- å®Œæ•´æµç¨‹è‡ªåŠ¨åŒ–
- éƒ¨åˆ†æµç¨‹æ‰§è¡Œ
- å•æ­¥æ“ä½œ

### æ™ºèƒ½åŒ–

- è‡ªåŠ¨è¯†åˆ«åˆ†æ”¯
- æ™ºèƒ½ç”Ÿæˆ commit æ¶ˆæ¯
- è‡ªåŠ¨è®¾ç½®ä¸Šæ¸¸åˆ†æ”¯

### ç”¨æˆ·å‹å¥½

- æ¸…æ™°çš„æ­¥éª¤åé¦ˆ
- å‹å¥½çš„é”™è¯¯æç¤º
- æ‰‹åŠ¨æ‰§è¡Œçš„å‘½ä»¤å»ºè®®

## ğŸš€ æœªæ¥æ‰©å±•

åŸºäºè¿™ä¸ªæ¶æ„ï¼Œå¯ä»¥è½»æ¾æ‰©å±•ï¼š

### 1. äº¤äº’å¼ç¡®è®¤

```python
def git_commit_confirmation_node(state):
    """è®©ç”¨æˆ·ç¡®è®¤ commit æ¶ˆæ¯"""
    commit_message = state["git_commit_message"]
    confirm = input(f"\næ¶ˆæ¯: {commit_message}\næ˜¯å¦æäº¤? (y/n): ")
    return {"git_commit_confirmed": confirm.lower() == 'y'}
```

### 2. å†²çªå¤„ç†

```python
def git_conflict_resolver_node(state):
    """æ™ºèƒ½å†²çªè§£å†³"""
    # åˆ†æå†²çªæ–‡ä»¶
    # æä¾›è§£å†³å»ºè®®
    # æˆ–å¯åŠ¨äº¤äº’å¼è§£å†³
```

### 3. åˆ†æ”¯ç®¡ç†

```python
def git_branch_manager_node(state):
    """åˆ›å»ºã€åˆ‡æ¢ã€åˆ é™¤åˆ†æ”¯"""
```

### 4. æ ‡ç­¾ç®¡ç†

```python
def git_tag_node(state):
    """åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾å¹¶æ¨é€"""
```

## ğŸ‰ æ€»ç»“

è¿™æ¬¡å®ç°å±•ç¤ºäº†ï¼š

1. âœ… **LangGraph çš„å¼ºå¤§** - å¤æ‚çš„å¤šæ­¥éª¤å·¥ä½œæµç®¡ç†
2. âœ… **çµæ´»çš„æ¶æ„** - æ”¯æŒå¤šç§ä½¿ç”¨åœºæ™¯
3. âœ… **æ™ºèƒ½åŒ–** - è‡ªåŠ¨åˆ†æ”¯è¯†åˆ«ã€æ™ºèƒ½æ¶ˆæ¯ç”Ÿæˆ
4. âœ… **ç”¨æˆ·ä½“éªŒ** - è¯¦ç»†åé¦ˆã€å‹å¥½é”™è¯¯æç¤º
5. âœ… **å¯æ‰©å±•æ€§** - æ˜“äºæ·»åŠ æ–°åŠŸèƒ½

ç°åœ¨ä½ å¯ä»¥ç”¨ä¸€å¥è¯ **"åŒæ­¥å¹¶æäº¤"** å®Œæˆä» pull åˆ° push çš„å…¨éƒ¨æ“ä½œï¼Œè€Œä¸”ä¼šè‡ªåŠ¨è¯†åˆ«ä½ åœ¨ devã€main è¿˜æ˜¯ä»»ä½•å…¶ä»–åˆ†æ”¯ï¼ğŸ‰

---

**Made with â¤ï¸ using LangGraph**

