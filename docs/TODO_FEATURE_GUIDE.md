# 待办事项功能使用指南

## 功能概述

AI Agent 现已集成个人助手功能，支持自然语言添加和查询待办事项。

## 主要特性

✅ **智能解析** - 自然语言输入，自动识别日期、时间和内容  
✅ **按日期存储** - 每天的待办事项独立存储为 JSON 文件  
✅ **灵活查询** - 支持多种查询方式（今天、特定日期、日期范围、未来N天、关键词搜索）  
✅ **不影响现有功能** - 完全独立的模块，不干扰终端命令和文件操作  

## 使用方法

### 1. 添加待办事项

使用自然语言描述你的待办事项，AI 会自动识别日期、时间和内容：

```bash
# 今天的待办
ai-agent "今天18点我要给陈龙打电话"
ai-agent "今天下午3点半交报告"

# 明天的待办
ai-agent "明天上午10点开会"
ai-agent "明天提醒我买菜"

# 具体日期（AI 会根据上下文理解）
ai-agent "周五下午2点参加面试"
ai-agent "下周一早上9点团队会议"
```

**响应示例：**
```
✅ 待办已添加！

📅 日期: 2025-10-22
⏰ 时间: 18:00
📝 内容: 给陈龙打电话

💡 你可以随时问我「今天有什么要做的？」或「2025-10-22有什么待办？」来查看待办事项。
```

### 2. 查询待办事项

#### 查询今天的待办
```bash
ai-agent "今天有什么要做的？"
ai-agent "今天的待办事项"
ai-agent "今天有什么任务？"
```

#### 查询特定日期
```bash
ai-agent "明天有什么待办？"
ai-agent "10月25号有什么安排？"
```

#### 查询日期范围
```bash
ai-agent "这周有什么任务？"
ai-agent "未来3天有什么待办？"
ai-agent "本月的待办事项"
```

#### 搜索关键词
```bash
ai-agent "陈龙相关的待办"
ai-agent "搜索会议相关的任务"
```

**响应示例：**
```
📅 今天（2025-10-22）的待办:

1. ⏰ 14:30 - 参加会议
2. ⏰ 18:00 - 给陈龙打电话
3. ⏰  - 复习英语
```

## 数据存储

### 文件结构
```
todos/
├── 2025-10-22.json
├── 2025-10-23.json
└── ...
```

### JSON 格式
```json
{
  "date": "2025-10-22",
  "todos": [
    {
      "id": "c6f64ff1-9055-495d-96b0-8991e7ff5183",
      "time": "18:00",
      "content": "给陈龙打电话",
      "status": "pending",
      "created_at": "2025-10-22 09:35:22"
    }
  ]
}
```

### 字段说明
- `id`: 待办事项的唯一标识符（UUID）
- `time`: 时间（格式：HH:MM），可为空
- `content`: 待办内容
- `status`: 状态（pending/completed）
- `created_at`: 创建时间

## 技术实现

### 模块组成

1. **todo_manager.py** - 待办事项管理核心模块
   - 支持增删改查操作
   - 按日期存储和检索
   - 关键词搜索

2. **agent_nodes.py** - 新增 `todo_processor` 节点
   - 使用 LLM 解析自然语言输入
   - 识别添加或查询意图
   - 提取日期、时间和内容

3. **agent_workflow.py** - 工作流路由
   - 新增 `add_todo` 和 `query_todo` 意图
   - 添加待办处理路径

4. **agent_config.py** - 状态管理
   - 新增待办相关状态字段

### 工作流程

```
用户输入
    ↓
文件引用处理
    ↓
意图分析 (识别为 add_todo 或 query_todo)
    ↓
待办处理器 (todo_processor)
    ↓
    ├─ add_todo: LLM 解析 → 保存到 JSON
    └─ query_todo: LLM 解析 → 从 JSON 读取
    ↓
格式化响应
    ↓
返回结果
```

## 与现有功能的兼容性

✅ **完全独立** - 待办功能作为新的意图类型，不影响现有的：
- 终端命令执行
- 文件操作（MCP 工具）
- Git commit 生成
- 对话问答

✅ **无冲突** - 数据存储在独立的 `todos/` 目录

✅ **可扩展** - 预留了状态更新、删除等接口

## 示例场景

### 场景 1：日常任务管理
```bash
# 早上规划一天
ai-agent "今天上午10点开晨会"
ai-agent "今天下午2点完成代码评审"
ai-agent "今天晚上7点健身"

# 查看今天的安排
ai-agent "今天有什么要做的？"
```

### 场景 2：多人协作提醒
```bash
ai-agent "明天下午3点和张三讨论项目"
ai-agent "周五给李四发送报告"

# 搜索与特定人相关的待办
ai-agent "搜索张三相关的任务"
```

### 场景 3：周计划管理
```bash
ai-agent "周一上午9点团队站会"
ai-agent "周三下午1点客户演示"
ai-agent "周五下午5点周报总结"

# 查看本周安排
ai-agent "这周有什么任务？"
```

## 未来扩展

可以在此基础上添加：
- ⏰ 定时提醒功能
- ✅ 待办完成标记
- 🔄 待办编辑和删除（通过自然语言）
- 📊 待办统计和分析
- 🔔 到期提醒
- 📱 集成日历系统

## 常见问题

### Q: 为什么我的输入没有被识别为待办？
A: 确保输入包含明确的时间和动作，例如："今天18点给陈龙打电话"。如果输入过于模糊（如"提醒我"），可能被识别为普通问题。

### Q: 如何修改或删除待办？
A: 当前版本主要支持添加和查询。如需修改，可以直接编辑 `todos/` 目录下的 JSON 文件。后续版本会支持自然语言修改和删除。

### Q: 待办数据存储在哪里？
A: 所有待办数据按日期存储在 `todos/` 目录下，格式为 `YYYY-MM-DD.json`。

### Q: 如何备份待办数据？
A: 直接复制 `todos/` 目录即可。建议定期备份或使用 Git 管理。

## 注意事项

1. **日期识别**：依赖 LLM 的日期理解能力，大部分情况准确，建议使用明确的时间描述（如"今天18点"而不是"晚些时候"）
2. **数据备份**：待办数据存储在 `todos/` 目录，建议定期备份
3. **时区**：使用系统本地时间
4. **并发**：当前版本不支持多进程并发写入，单用户使用无问题
5. **意图识别**：已优化 prompt，优先识别待办相关输入。如果仍被误判，可以使用更明确的表述

## 测试

运行测试脚本验证功能：
```bash
python3 test/test_todo.py
```

## 总结

待办事项功能为 AI Agent 增加了个人助手能力，让你可以通过自然语言轻松管理日常任务，无需记忆复杂的命令格式。与现有功能完美集成，互不干扰。
