---
description: LangGraph å·¥ä½œæµå¼€å‘æŒ‡å—
---

# LangGraph å·¥ä½œæµå¼€å‘æŒ‡å—

## å·¥ä½œæµæ¶æ„
æ‰€æœ‰å·¥ä½œæµå®šä¹‰åœ¨ [agent_workflow.py](mdc:agent_workflow.py) ä¸­ï¼ŒèŠ‚ç‚¹å®ç°åœ¨ [agent_nodes.py](mdc:agent_nodes.py) ä¸­ã€‚

## çŠ¶æ€å®šä¹‰
ä½¿ç”¨ TypedDict å®šä¹‰çŠ¶æ€ï¼Œåœ¨ [agent_config.py](mdc:agent_config.py) ä¸­ï¼š

```python
class AgentState(TypedDict):
    user_input: str           # ç”¨æˆ·åŸå§‹è¾“å…¥
    intent: str              # æ„å›¾ç±»å‹
    command: str             # è¦æ‰§è¡Œçš„å‘½ä»¤
    response: str            # è¿”å›ç»™ç”¨æˆ·çš„å“åº”
    error: str               # é”™è¯¯ä¿¡æ¯
    chat_history: list       # å¯¹è¯å†å²
    referenced_files: list   # @ å¼•ç”¨çš„æ–‡ä»¶
    file_contents: dict      # æ–‡ä»¶å†…å®¹ç¼“å­˜
    # ... æ›´å¤šå­—æ®µ
```

## èŠ‚ç‚¹å¼€å‘è§„èŒƒ

### èŠ‚ç‚¹å‡½æ•°ç­¾å
```python
def node_name(state: AgentState) -> AgentState:
    """
    èŠ‚ç‚¹åŠŸèƒ½æè¿°
    
    Args:
        state: å½“å‰çŠ¶æ€
    
    Returns:
        æ›´æ–°åçš„çŠ¶æ€
    """
    # å®ç°é€»è¾‘
    return state
```

### èŠ‚ç‚¹ç±»å‹

1. **åˆ†æèŠ‚ç‚¹**ï¼šè§£æç”¨æˆ·è¾“å…¥ï¼ˆä½¿ç”¨ LLM_CONFIGï¼‰
   - `intent_analyzer()` - æ„å›¾åˆ†æ
   - `file_reference_resolver()` - æ–‡ä»¶å¼•ç”¨è§£æ

2. **ç”ŸæˆèŠ‚ç‚¹**ï¼šç”Ÿæˆå‘½ä»¤/ä»£ç ï¼ˆä½¿ç”¨ LLM_CONFIG2ï¼‰
   - `command_generator()` - å‘½ä»¤ç”Ÿæˆ
   - `multi_step_planner()` - å¤šæ­¥éª¤è§„åˆ’

3. **æ‰§è¡ŒèŠ‚ç‚¹**ï¼šæ‰§è¡Œæ“ä½œ
   - `command_executor()` - å‘½ä»¤æ‰§è¡Œ
   - `file_creator()` - æ–‡ä»¶åˆ›å»º
   - `mcp_tool_executor()` - MCP å·¥å…·è°ƒç”¨

4. **å“åº”èŠ‚ç‚¹**ï¼šç”Ÿæˆç”¨æˆ·å“åº”
   - `question_answerer()` - æ™ºèƒ½é—®ç­”
   - `response_generator()` - å“åº”ç”Ÿæˆ

## æ¡ä»¶è·¯ç”±
ä½¿ç”¨æ¡ä»¶å‡½æ•°å†³å®šä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼š

```python
def router(state: AgentState) -> str:
    """æ ¹æ®çŠ¶æ€å†³å®šè·¯ç”±"""
    if state["intent"] == "execute":
        return "command_executor"
    elif state["intent"] == "question":
        return "question_answerer"
    # ...
```

## æœ€ä½³å®è·µ

### é”™è¯¯å¤„ç†
æ¯ä¸ªèŠ‚ç‚¹éƒ½åº”æ•è·å¼‚å¸¸å¹¶è®¾ç½® `state["error"]`

### æ—¥å¿—è¾“å‡º
ä½¿ç”¨ emoji å’Œæ¸…æ™°çš„æ¶ˆæ¯ï¼š
```python
print("ğŸ¤– æ­£åœ¨åˆ†ææ„å›¾...")
print("âœ… å‘½ä»¤æ‰§è¡ŒæˆåŠŸ")
print("âŒ å‘ç”Ÿé”™è¯¯: ...")
```

### çŠ¶æ€æ›´æ–°
åªä¿®æ”¹éœ€è¦æ›´æ–°çš„å­—æ®µï¼Œä¿æŒå…¶ä»–å­—æ®µä¸å˜

### LLM é€‰æ‹©
- ç†è§£å’Œåˆ†æ â†’ LLM_CONFIG
- ä»£ç å’Œå‘½ä»¤ç”Ÿæˆ â†’ LLM_CONFIG2

## æ·»åŠ æ–°èŠ‚ç‚¹çš„æ­¥éª¤
1. åœ¨ [agent_nodes.py](mdc:agent_nodes.py) ä¸­å®ç°èŠ‚ç‚¹å‡½æ•°
2. åœ¨ [agent_workflow.py](mdc:agent_workflow.py) ä¸­æ·»åŠ èŠ‚ç‚¹åˆ°å›¾
3. æ›´æ–°è·¯ç”±é€»è¾‘
4. å¦‚éœ€è¦ï¼Œæ›´æ–° AgentState å®šä¹‰
5. æ·»åŠ ç›¸åº”çš„æµ‹è¯•
